# 仕様書: ローカル文字起こし & 会議録整形アプリ

## 概要

本アプリケーションは、長時間の会議録音（例：市議会）を入力し、自動的に議事録風に整形された文章として出力する。**リテラシーの低いユーザーでも使いやすいUI/UX** と **機密性の高いデータ処理** を重視し、文字起こし、不要部分の除去、表現の統一を経て Word 形式の会議録を生成する。

---

## 要件

### 機能要件

1. **音声入力**

   * ユーザーが音声ファイル（WAV, MP3, M4A 等）をドラッグ＆ドロップして取り込む。
   * 2時間以上の長時間録音に対応。

2. **文字起こし**

   * 音声を自動的に約5分単位に分割。
   * 各分割を **OpenAI Whisper API** で処理。
   * 結果を逐次UIに反映。

3. **整形／ケバ取り**

   * 文字起こし結果を **OpenAI GPT API** に送信し整形。
   * 整形ルール（Cレベル = 議会議事録風）：

     * 文体を常に「です／ます」調に統一
     * フィラー削除（「えー」「あのー」等）
     * 相槌削除（「はい」「ええ」等）
     * 言い直しの整理（「○○…いや、○○です」→「○○です」）
     * 長文を意味ごとに分割
     * 語尾・表現を公式な言い回しに統一

4. **出力**

   * 整形済みテキストを画面プレビューに表示。
   * **Word（.docx）形式**で保存可能。
   * ファイル名規則：`<元ファイル名>_minutes.docx`

5. **進捗管理と信頼性**

   * 進捗バーで完了率と残り時間目安を表示。
   * 30秒ごとにローカル自動保存。
   * クラッシュ時は前回保存地点から再開可能。

---

### 非機能要件

* **クロスプラットフォーム**: Windowsを優先対象、macOSでも動作。
* **UI/UX**: Material Design 3 準拠。

  * ワン画面構成。
  * 左：ファイルドロップエリア＋進捗表示。
  * 右：整形済みテキストプレビュー。
  * 下：保存ボタン（Word出力）。
* **パフォーマンス**: 2時間以上の音声でもUIが固まらない（バックグラウンド処理）。
* **セキュリティ／プライバシー**:

  * OpenAI APIを使用（データは学習に利用されない）。
  * API送信データは最大30日保持（OpenAIのポリシー準拠）。
  * ユーザー保存以外の形でローカルに記録しない。

---

## アーキテクチャ

### フロントエンド

* **Electron + React** でデスクトップアプリを構築。
* UIコンポーネントは **Material Design 3 (MUI v5)** を利用。
* ファイルのドラッグ＆ドロップはElectron APIを使用。

### バックエンド（Electron内）

* **Node.js** で処理を制御。
* **音声分割**: ffmpegラッパーで約5分単位に分割。
* **文字起こし**: Whisper API呼び出し。
* **整形処理**: GPT APIに全文を送信し整形。
* **Word出力**: `docx` npmライブラリで生成。

### データフロー

1. ファイルドロップ → 一時保存。
2. ffmpegで分割。
3. Whisper APIで逐次文字起こし。
4. 中間結果をUI表示。
5. 全文完成後にGPT APIで整形。
6. プレビュー更新。
7. 保存操作で `.docx` 出力。

---

## データ管理

* **一時ファイル**: OSの一時フォルダに保存、終了時に削除。
* **自動保存**: 部分文字起こしをJSON形式で保存。
* **最終出力**: `.docx` のみユーザー明示保存。
* **APIキー管理**: Electron暗号化ストレージに安全に格納。

---

## エラーハンドリング

* **ネットワークエラー**: 各チャンク3回までリトライ（指数バックオフ）。
* **APIレート制限**: 残りチャンクをキューに入れて待機処理。
* **ファイルエラー**: 不正フォーマット時にエラーダイアログ表示。
* **クラッシュ復旧**: 再起動時に自動保存データを復元して続行。
* **部分完了**: 必要に応じて部分的な文字起こし結果をエクスポート可能。

---

## テスト計画

### 単体テスト

* ffmpeg分割処理
* Whisper API呼び出し（モックレスポンス）
* GPT整形関数（モックプロンプト／レスポンス）
* docx生成

### 結合テスト

* サンプル30分音声のエンドツーエンド処理
* 自動保存＋クラッシュ復旧
* APIレート制限シナリオ

### UXテスト

* Windows Explorer / Finder からドラッグ＆ドロップ
* 2時間以上の音声で進捗表示が正しく動作
* 非技術者がファイル入力→プレビュー→保存できるか確認

### パフォーマンステスト

* 2時間音声を処理するベンチマーク
* メモリ使用量の監視

---

## 将来拡張

* PDF出力対応
* 話者分離（名簿CSVとのマッピング）
* 保存前の手動編集機能
* オフライン文字起こし（Whisper.cpp対応）
